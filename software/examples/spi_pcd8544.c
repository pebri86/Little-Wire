/*
=================================================================================
 Name        : pcd8544_test.c
 Version     : 0.1

 Copyright (C) 2010 Limor Fried, Adafruit Industries
 Raspberry Pi version by Andre Wussow, 2012, desk@binerry.de

 Description :
     A simple PCD8544 LCD (Nokia3310/5110) test for Raspberry PI PCD8544 Library.
	 Based on Limor Fried's PCD8544 Arduino samples
	 (https://github.com/adafruit/Adafruit-PCD8544-Nokia-5110-LCD-library/blob/master/examples/pcdtest/pcdtest.pde)
	 Makes use of WiringPI-library of Gordon Henderson (https://projects.drogon.net/raspberry-pi/wiringpi/)

	 Recommended connection (http://www.raspberrypi.org/archives/384):
	 LCD pins      Raspberry Pi
	 LCD1 - GND    P06  - GND
	 LCD2 - VCC    P01 - 3.3V
	 LCD3 - CLK    P11 - GPIO0
	 LCD4 - Din    P12 - GPIO1
	 LCD5 - D/C    P13 - GPIO2
	 LCD6 - CS     P15 - GPIO3
	 LCD7 - RST    P16 - GPIO4
	 LCD8 - LED    P01 - 3.3V

================================================================================
This library is free software; you can redistribute it and/or
modify it under the terms of the GNU Lesser General Public
License as published by the Free Software Foundation; either
version 2.1 of the License, or (at your option) any later version.

This library is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
Lesser General Public License for more details.
================================================================================
 */

#include <stdio.h>
#include <stdlib.h>
#include "littleWire.h"
#include "littleWire_util.h"
#include "PCD8544.h"

// this generated by Image2GLCD
const unsigned char img[] = {
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 
0x90, 0xB0, 0xA0, 0x62, 0x36, 0x38, 0x38, 0x30, 0x19, 0x19, 0x01, 0x0F, 0x1F, 0x3E, 0x3E, 0x3C, 
0x3E, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFE, 0xFE, 0xFC, 0xF8, 0xF0, 0xE0, 0xC0, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0C, 0x1E, 0x3F, 0x3F, 0x3F, 0x3F, 0x3F, 
0x3F, 0x1F, 0x1E, 0x00, 0x00, 0xC0, 0x60, 0xFC, 0x7E, 0xFE, 0xFE, 0xFE, 0xFF, 0xFF, 0xF3, 0xF3, 
0x11, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 

0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x02, 0x04, 0x02, 0x0F, 0x3F, 0x3F, 0x03, 0x07, 0x07, 0x0E, 0x1D, 0x0F, 0x0E, 0x0C, 0x09, 0x01, 
0x03, 0x03, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0xFC, 0xFC, 0x84, 0x84, 0xCC, 0x7C, 
0x78, 0x78, 0x38, 0x00, 0xFC, 0xFC, 0xFC, 0xFC, 0x44, 0x44, 0x44, 0x44, 0x44, 0x04, 0x00, 0x00, 
0xFC, 0xFC, 0xFC, 0xFC, 0x84, 0xC4, 0xCC, 0xFC, 0x78, 0x38, 0x00, 0x00, 0xFC, 0xFC, 0xFC, 0xFC, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0xFC, 0x00, 0xFC, 0xFC, 0xFC, 0xFC, 0x84, 0xC4, 
0xCC, 0xFC, 0x78, 0x38, 0x30, 0x00, 0x00, 0x00, 0xFC, 0xFC, 0xFC, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0x0F, 0x0F, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x0F, 0x0F, 0x0F, 0x0C, 0x0C, 0x0C, 0x0C, 
0x0C, 0x0C, 0x00, 0x00, 0x0F, 0x0F, 0x0F, 0x00, 0x00, 0x01, 0x03, 0x07, 0x0F, 0x0E, 0x0C, 0x08, 
0x00, 0x03, 0x07, 0x07, 0x0C, 0x0C, 0x08, 0x08, 0x08, 0x04, 0x06, 0x07, 0x01, 0x00, 0x07, 0x0F, 
0x0F, 0x0F, 0x00, 0x00, 0x01, 0x03, 0x07, 0x0E, 0x0E, 0x0C, 0x00, 0x00, 0x0F, 0x0F, 0x0F, 0x00 
};

// pin setup
int _dc = PIN3;
int _rst = PIN4;

unsigned char version;

// lcd contrast
int contrast = 50;

int main (void)
{
    littleWire *lw = NULL;

    lw = littleWire_connect();

    if(lw == NULL)
        {
            printf("> Little Wire could not be found!\n");
            exit(EXIT_FAILURE);
        }

    version = readFirmwareVersion(lw);
    printf("> Little Wire firmware version: %d.%d\n",((version & 0xF0)>>4),(version&0x0F));
    if(version==0x10)
        {
            printf("> This example requires the new 1.1 version firmware. Please update soon.\n");
            return 0;
        }

    spi_updateDelay(lw, 0);

    // init and clear lcd
    LCDInit(lw, _dc, _rst, contrast);
    LCDclear(lw);

    // turn all the pixels on (a handy test)
    printf("Test: All pixels on.\n");
    LCDcommand(lw,PCD8544_DISPLAYCONTROL | PCD8544_DISPLAYALLON);
    delay(1000);
    // back to normal
    printf("Test: All pixels off.\n");
    LCDcommand(lw,PCD8544_DISPLAYCONTROL | PCD8544_DISPLAYNORMAL);
    LCDclear();

    // display logo
    printf("Test: Display logo.\n");

    LCDshowLogo(lw);
    delay(2000);
    LCDclear();
    LCDdisplay(lw);

    // draw a single pixel
    printf("Test: Display single pixel.\n");
    LCDsetPixel(10, 10, BLACK);
    LCDdisplay(lw);
    delay(2000);
    LCDclear();
    LCDdisplay(lw);

    // draw many lines
    printf("Test: Draw many lines.\n");
    int i;
    for (i=0; i<84; i+=4)
        {
            LCDdrawline(0, 0, i, 47, BLACK);
            LCDdisplay(lw);
        }
    for (i=0; i<48; i+=4)
        {
            LCDdrawline(0, 0, 83, i, BLACK);
            LCDdisplay(lw);
        }
    delay(2000);
    LCDclear();
    LCDdisplay(lw);

    // draw rectangles
    printf("Test: Draw rectangles.\n");
    for (i=0; i<48/2; i+=2)
        {
            LCDdrawrect(i, i, 84-2*i, 48-2*i, BLACK);
            LCDdisplay(lw);
        }
    delay(2000);
    LCDclear();
    LCDdisplay(lw);

    // draw rounded rectangles
    printf("Test: Draw rounded rectangles.\n");
    for (i=0; i<48/2-2; i+=2)
        {
            LCDdrawRoundRect(i, i, 84-2*i, 48-2*i, 48/10, BLACK);
            LCDdisplay(lw);
        }
    delay(2000);
    LCDclear();
    LCDdisplay(lw);

    // draw mulitple circles
    printf("Test: Draw multiple circles.\n");
    for (i=0; i<48/2; i+=2)
        {
            LCDdrawcircle(84/2, 48/2, i, BLACK);
            LCDdisplay(lw);
        }
    delay(2000);
    LCDclear();
    LCDdisplay(lw);

    // draw the first ~120 characters in the font
    printf("Test: Draw the first ~120 chars.\n");
    for (i=0; i < 64; i++)
        {
            LCDdrawchar((i % 14) * 6, (i/14) * 8, i, BLACK, WHITE, 1);
            LCDdisplay(lw);
        }
    delay(2000);
    for (i=0; i < 64; i++)
        {
            LCDdrawchar((i % 14) * 6, (i/14) * 8, i + 64, BLACK, WHITE, 1);
            LCDdisplay(lw);
        }
    delay(2000);
    LCDclear();
    LCDdisplay(lw);


    LCDdrawbitmap(0,0, img, 84, 48, BLACK);
    LCDdisplay(lw);
    LCDclear();

    return 0;
}
